#no res

###Lectura i vista de les dades
library(sampling)
base<-read.table("AnuarioN.CSV",header=TRUE,sep=";",dec=",",row.names=1)
names(base)
head(base)
set.seed(1347)

###N tamany de la població

N<-length(base$Codigo)
n<-100	
muninames<-row.names(base)

###S'escull la mostra i es defineix variable de interès:

s<-srswor(n,N)
muestra <-getdata(base,s)

#Cas de estatus a l'atzar
nprim<-80 #els que han respost
Muestra<-cbind.data.frame(muestra,status=srswor(nprim,n))
celdas<-rhg(Muestra,selection='Size_pob')

#Estimació del total a partir dels que responen 
y<-celdas$ActComMinor
yr<-y[celdas$status==1]
Thatr<-mean(yr)*N	# Estimació de la probabilitat de resposta
rhgroup<- as.factor(celdas$rhgroup)

#tamaño de las muestras en las celdas
nh<-tapply(y,rhgroup,length)

#media de los respondientes por celda
rhgroupr<-rhgroup[celdas$status==1]
media_h<-tapply(yr,rhgroupr,mean)
ThatR<-N*sum(media_h*nh/n)	# Estimació dels respoonents per celda

#Estimación post-estratificada 
Size_pob<-base$Size_pob
Nh<-tapply(Size_pob,Size_pob,length)
Thatpost<-N*sum(media_h*Nh/N)	# Estimació per post-estratificació