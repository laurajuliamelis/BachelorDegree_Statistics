#RE

###Part de desiguals a la pràctica anterior
###Lectura i vista de les dades
library(sampling)
base<-read.table("AnuarioN.CSV",header=TRUE,sep=";",dec=",",row.names=1)
names(base)
head(base)
set.seed(1347)
###N tamany de la població
N<-length(base$Codigo)
n<-100

totalpob<-sum(base$ActComMinor)
medpob<-totalpob/N
Qvar<-var(base$ActComMinor)
Xpob<-base$Pob2010	
muninames<-row.names(base)

###S'escull la mostra i es defineix variable de interès:

s<-srswor(n,N)
muestra <-getdata(base,s)
y<-muestra$ActComMinor #variable d'interès per individuos de la mostra
pik=rep(n/N,n)	#com és disseny simple, tots tenen el mateix pes


### Estimadors del total

totaly<-HTestimator(y,pik) #Estimació del total
VarExactS_T<- (N*N)*(1-n/N)*Qvar/n #Variança de l’estimador 
varhatT<-varest(Ys=y,pik=pik)	#Estimació de l variança 
liminfT<-totaly-2*sqrt(varhatT)	#Interval de confiança del total
limsupT<-totaly+2*sqrt(varhatT)

### estimadors de la mitjana 

medhat<-totaly/N	#Estimació de la mitjana
VarExactM<-VarExactS_T/(N*N) #Variança de l’estimador
varhatM<-varhatT/(N*N)	#Estimació de l variança 
liminfM<-medhat-2*sqrt(varhatM)	#Interval de confiança
limsupM<-medhat+2*sqrt(varhatM)

### RECOMPOSICIÓ

x<-base$Pob2010[s==1]
Tx<-sum(base$Pob2010)
Rhat<-meanSí/mean(x)
u<-y-Rhat*x
Y<-base$ActComMinor
R<-mean(Y)/mean(Xpob)
U<-Y-R*Xpob

### Estimadors del total

EstimratioT<-ratioest(y,x,Tx,pik) #Estimació del total
Varexact_ratioT<- N*N*(1-n/N)*var(U)/n #Variança de l’estimador 
VarhatTratio<-N*N*(1-n/N)*var(u)/n #Estimació de l variança 
liminfT<-EstimratioT-2*sqrt(VarhatTratio) #Interval de confiança del total
limsupT<-EstimratioT+2*sqrt(VarhatTratio)

### estimadors de la mitjana 

EstimratioM<-EstimratioT/218	#Estimació de la mitjana
Varexact_ratioM<- Varexact_ratioT/(N*N) #Variança de l’estimador 
VarhatMratio<-VarhatTratio/(N*N) #Estimació de l variança 
liminfM<-EstimratioM-2*sqrt(VarhatMratio) #Interval de confiança 
limsupM<-EstimratioM+2*sqrt(VarhatMratio)